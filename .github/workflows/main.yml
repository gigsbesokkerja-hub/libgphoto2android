name: Dapatkan File SO
on: [workflow_dispatch] 

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Java (Untuk mesin Android)
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Jalankan Build Android (Jika ada)
        run: |
          if [ -f "gradlew" ]; then
            chmod +x gradlew
            ./gradlew assembleDebug || echo "Build log selesai. Melanjutkan pencarian file..."
          else
            echo "Tidak ada gradlew. Langsung mencari file .so bawaan..."
          fi

      - name: Sisir dan Kumpulkan Semua File .so
        run: |
          mkdir -p hasil_so
          
          # Cari semua file .so dan pertahankan nama folder arsitekturnya (arm64-v8a, dll)
          find . -name "*.so" | while read file; do
            arch_folder=$(basename $(dirname "$file"))
            mkdir -p "hasil_so/$arch_folder"
            cp "$file" "hasil_so/$arch_folder/"
          done
          
          echo "Daftar file yang berhasil ditemukan:"
          ls -R hasil_so

      - name: Simpan Hasil (Upload Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: file-so-kamera
          path: hasil_so/
